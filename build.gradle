group 'com.github.kright.androidscalasupport'
version '0.1'

apply plugin: 'groovy'
apply plugin: 'maven'


allprojects {
    repositories {
        mavenCentral()
        jcenter()
    }
}

buildscript {
    repositories {
        mavenCentral()
    }

    dependencies {
        classpath 'com.github.dcendents:android-maven-gradle-plugin:1.5'
    }
}

dependencies {
    compile project(':plugin')
}


task testExamplesBuild {
    description = "builds examples projects"
}

//build.dependsOn(testExamplesBuild) it's like a fork bomb now

testExamplesBuild << {
    def examplesDirs = new File("./examples").listFiles()
    examplesDirs.each { exampleDir ->
        print("building example project '${exampleDir.name}' : ")

        def gradleCommand = exampleDir.absolutePath + File.separator + "gradlew.bat"
        def processBuilder = new ProcessBuilder([gradleCommand, "build"])

        def process = processBuilder.start()
        process.waitFor()

        def success = process.exitValue() == 0

        println(success ? "success" : "fail")
        if (!success) {
            throw new TaskExecutionException(it, new Exception("project example ${exampleDir.name} wasn't builded"))
        }
    }
}